{"version":3,"sources":["components/Logo.jsx","components/Login/index.jsx","state.js","api.js","utils.js","components/Chat/components/ChatList/components/ChatIcon.jsx","components/Chat/components/ChatList/components/AvatarImage.jsx","components/Chat/components/OnlineIndicator.jsx","components/Chat/components/ChatList/components/ChatListItem/index.jsx","components/Chat/components/ChatList/components/Footer.jsx","components/Chat/components/ChatList/index.jsx","components/Chat/components/MessageList/components/InfoMessage.jsx","components/Chat/components/MessageList/components/MessagesLoading.jsx","components/Chat/components/MessageList/components/NoMessages.jsx","components/Chat/components/MessageList/components/ClockIcon.jsx","components/Chat/components/MessageList/components/ReceiverMessage.jsx","components/Chat/components/MessageList/components/SenderMessage.jsx","components/Chat/components/MessageList/index.jsx","components/Chat/components/TypingArea.jsx","components/Chat/use-chat-handlers.js","components/Chat/index.jsx","components/LoadingScreen.jsx","components/Navbar.jsx","hooks.js","App.jsx","index.jsx"],"names":["Logo","width","height","xmlns","xmlnsXlink","viewBox","id","d","transform","fill","xlinkHref","y","cx","cy","rx","ry","DEMO_USERS","Login","onLogIn","useState","Math","floor","random","length","username","setUsername","password","setPassword","error","setError","onSubmit","event","a","preventDefault","className","style","boxShadow","maxWidth","backgroundColor","paddingLeft","paddingRight","borderTopLeftRadius","borderTopRightRadius","alt","src","process","bottom","left","paddingTop","borderBottomLeftRadius","borderBottomRightRadius","htmlFor","value","onChange","target","type","placeholder","required","Toast","minWidth","onClose","show","delay","autohide","Header","Body","UsernameSelect","DropdownButton","menuAlign","title","map","name","i","Dropdown","Item","onClick","eventKey","reducer","state","action","currentRoom","rooms","users","payload","online","messages","offset","lastMessage","message","undefined","newRooms","forEach","room","initialState","AppContext","createContext","useAppState","useContext","useAppStateContext","useReducer","axios","defaults","withCredentials","url","x","getMe","get","then","data","catch","_","login","post","e","Error","response","logOut","getMessages","size","params","reverse","getUsers","ids","addRoom","user1","user2","getRooms","userId","parseRoomName","names","populateUsersFromLoadedMessages","require","dispatch","userIds","from","Object","keys","filter","newUsers","ChatIcon","stroke","strokeWidth","x1","y1","x2","y2","gradientUnits","stopColor","AvatarImage","useMemo","av","roomId","TOTAL_IMAGES","seed1","seed2","uidParsed","split","pop","roomIdParsed","theId","getAvatarByUserAndRoomId","objectFit","OnlineIndicator","hide","opacity","useChatListItemHandlers","pseudoUserId","abs","parseInt","isUser","usersFiltered","entries","useLastMessage","useEffect","ChatListItem","active","moment","unix","date","format","LogoutButton","onLogOut","col","noinfo","cursor","UserInfo","user","Footer","flex","minHeight","ChatList","processedRooms","roomsList","values","main","other","sort","b","InfoMessage","fontSize","MessagesLoading","role","NoMessages","ClockIcon","aria-hidden","ReceiverMessage","borderRadius","fontWeight","SenderMessage","onUserClicked","MessageList","messageListElement","onLoadMoreMessages","ref","aria-haspopup","aria-expanded","key","TypingArea","setMessage","tabIndex","useChatHandlers","useRef","scrollToTop","useCallback","setTimeout","current","scrollTop","scrollToBottom","scrollTo","top","scrollHeight","onFetchMessages","prepend","targetUser","Chat","onMessageSend","borderBottom","trim","LoadingScreen","GithubIcon","link","href","aria-labelledby","aria-describedby","data-name","Navbar","links","setLinks","github","updateUser","newUser","infoMessage","useAppHandlers","onUserLoaded","loading","setLoading","setUser","onError","onLoading","finally","useUser","connected","setConnected","socketRef","socket","disconnect","connect","io","on","console","log","off","useSocket","push","emit","Date","App","showLogin","Provider","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.a31e9571.chunk.js","sourcesContent":["const Logo = ({ width = 64, height = 64 }) => {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      viewBox=\"0 0 32 32\"\n      height={height}\n      width={width}\n    >\n      <script />\n      <defs>\n        <path\n          id=\"prefix__a\"\n          d=\"M45.536 38.764c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276c-1-.478-1.524-.88-1.524-1.26v-3.813s14.447-3.145 16.78-3.982 3.14-.867 5.126-.14 13.853 2.868 15.814 3.587v3.76c0 .377-.452.8-1.477 1.324z\"\n        />\n        <path\n          id=\"prefix__b\"\n          d=\"M45.536 28.733c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276-2.04-1.613-.077-2.382l15.332-5.935c2.332-.837 3.14-.867 5.126-.14s12.35 4.853 14.312 5.57 2.037 1.31.024 2.36z\"\n        />\n      </defs>\n      <g transform=\"matrix(.84833 0 0 .84833 -7.884 -9.45)\">\n        <use fill=\"#a41e11\" xlinkHref=\"#prefix__a\" />\n        <path\n          d=\"M45.536 34.95c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276-2.04-1.613-.077-2.382l15.332-5.936c2.332-.836 3.14-.867 5.126-.14S43.55 31.87 45.51 32.6s2.037 1.31.024 2.36z\"\n          fill=\"#d82c20\"\n        />\n        <use fill=\"#a41e11\" xlinkHref=\"#prefix__a\" y={-6.218} />\n        <use fill=\"#d82c20\" xlinkHref=\"#prefix__b\" />\n        <path\n          d=\"M45.536 26.098c-2.013 1.05-12.44 5.337-14.66 6.495s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276c-1-.478-1.524-.88-1.524-1.26V21.55s14.447-3.145 16.78-3.982 3.14-.867 5.126-.14 13.853 2.868 15.814 3.587v3.76c0 .377-.452.8-1.477 1.324z\"\n          fill=\"#a41e11\"\n        />\n        <use fill=\"#d82c20\" xlinkHref=\"#prefix__b\" y={-6.449} />\n        <g fill=\"#fff\">\n          <path d=\"M29.096 20.712l-1.182-1.965-3.774-.34 2.816-1.016-.845-1.56 2.636 1.03 2.486-.814-.672 1.612 2.534.95-3.268.34zM22.8 24.624l8.74-1.342-2.64 3.872z\" />\n          <ellipse cx={20.444} cy={21.402} rx={4.672} ry={1.811} />\n        </g>\n        <path d=\"M42.132 21.138l-5.17 2.042-.004-4.087z\" fill=\"#7a0c00\" />\n        <path\n          d=\"M36.963 23.18l-.56.22-5.166-2.042 5.723-2.264z\"\n          fill=\"#ad2115\"\n        />\n      </g>\n    </svg>\n  );\n};\n\nexport default Logo;\n","// @ts-check\r\nimport { Dropdown, DropdownButton, Toast } from \"react-bootstrap\";\r\nimport React, { useState } from \"react\";\r\nimport Logo from \"../Logo\";\r\nimport \"./style.css\";\r\n\r\nconst DEMO_USERS = [\"Pablo\", \"Joe\", \"Mary\", \"Alex\"];\r\n\r\nexport default function Login({ onLogIn }) {\r\n  const [username, setUsername] = useState(\r\n    () => DEMO_USERS[Math.floor(Math.random() * DEMO_USERS.length)]\r\n  );\r\n  const [password, setPassword] = useState(\"password123\");\r\n  const [error, setError] = useState(null);\r\n\r\n  const onSubmit = async (event) => {\r\n    event.preventDefault();\r\n    onLogIn(username, password, setError);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"login-form text-center login-page\">\r\n        <div\r\n          className=\"rounded\"\r\n          style={{\r\n            boxShadow: \"0 0.75rem 1.5rem rgba(18,38,63,.03)\",\r\n          }}\r\n        >\r\n          <div className=\"position-relative\">\r\n            <div\r\n              className=\"row no-gutters align-items-center\"\r\n              style={{\r\n                maxWidth: 400,\r\n                backgroundColor: \"rgba(85, 110, 230, 0.25)\",\r\n                paddingLeft: 20,\r\n                paddingRight: 20,\r\n                borderTopLeftRadius: 4,\r\n                borderTopRightRadius: 4,\r\n              }}\r\n            >\r\n              <div className=\"col text-primary text-left\">\r\n                <h3 className=\"font-size-15\">Welcome Back !</h3>\r\n                <p>Sign in to continue</p>\r\n              </div>\r\n              <div className=\"col align-self-end\">\r\n                <img\r\n                  alt=\"welcome back\"\r\n                  style={{ maxWidth: \"100%\" }}\r\n                  src={`${process.env.PUBLIC_URL}/welcome-back.png`}\r\n                />\r\n              </div>\r\n            </div>\r\n            <div\r\n              className=\"position-absolute\"\r\n              style={{ bottom: -36, left: 20 }}\r\n            >\r\n              <div\r\n                style={{\r\n                  backgroundColor: \"rgb(239, 242, 247)\",\r\n                  width: 72,\r\n                  height: 72,\r\n                }}\r\n                className=\"rounded-circle d-flex align-items-center justify-content-center\"\r\n              >\r\n                <Logo width={34} height={34} />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <form\r\n            className=\"bg-white text-left px-4\"\r\n            style={{\r\n              paddingTop: 58,\r\n              borderBottomLeftRadius: 4,\r\n              borderBottomRightRadius: 4,\r\n            }}\r\n            onSubmit={onSubmit}\r\n          >\r\n            <label className=\"font-size-12\">Name</label>\r\n            <div className=\"username-select mb-3\">\r\n              <UsernameSelect username={username} setUsername={setUsername} />\r\n            </div>\r\n\r\n            <label htmlFor=\"inputPassword\" className=\"font-size-12\">\r\n              Password\r\n            </label>\r\n            <input\r\n              value={password}\r\n              onChange={(event) => setPassword(event.target.value)}\r\n              type=\"password\"\r\n              id=\"inputPassword\"\r\n              className=\"form-control\"\r\n              placeholder=\"Password\"\r\n              required\r\n            />\r\n            <div style={{ height: 30 }} />\r\n            <button className=\"btn btn-lg btn-primary btn-block\" type=\"submit\">\r\n              Sign in\r\n            </button>\r\n            <div className=\"login-error-anchor\">\r\n              <div className=\"toast-box\">\r\n                <Toast\r\n                  style={{ minWidth: 277 }}\r\n                  onClose={() => setError(null)}\r\n                  show={error !== null}\r\n                  delay={3000}\r\n                  autohide\r\n                >\r\n                  <Toast.Header>\r\n                    <img\r\n                      src=\"holder.js/20x20?text=%20\"\r\n                      className=\"rounded mr-2\"\r\n                      alt=\"\"\r\n                    />\r\n                    <strong className=\"mr-auto\">Error</strong>\r\n                  </Toast.Header>\r\n                  <Toast.Body>{error}</Toast.Body>\r\n                </Toast>\r\n              </div>\r\n            </div>\r\n            <div style={{ height: 30 }} />\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nconst UsernameSelect = ({ username, setUsername }) => {\r\n  return (\r\n    <DropdownButton\r\n      menuAlign=\"right\"\r\n      title={username}\r\n      id=\"dropdown-menu-align-right\"\r\n    >\r\n      {DEMO_USERS.map((name, i) => (\r\n        <Dropdown.Item\r\n          key={name}\r\n          onClick={() => setUsername(name)}\r\n          eventKey={\"\" + (i + 1)}\r\n        >\r\n          {name}\r\n        </Dropdown.Item>\r\n      ))}\r\n    </DropdownButton>\r\n  );\r\n};\r\n","// @ts-check\r\nimport { createContext, useContext, useReducer } from \"react\";\r\n\r\n/**\r\n * @typedef {{\r\n *  from: string\r\n *  date: number\r\n *  message: string\r\n *  roomId?: string\r\n * }} Message\r\n *\r\n * @typedef {{\r\n *   name: string;\r\n *   id: string;\r\n *   messages?: Message[]\r\n *   connected?: boolean;\r\n *   offset?: number;\r\n *   forUserId?: null | number | string\r\n *   lastMessage?: Message | null\r\n * }} Room\r\n *\r\n * @typedef {{\r\n *   username: string;\r\n *   id: string;\r\n *   online?: boolean;\r\n *   room?: string;\r\n * }} UserEntry\r\n *\r\n * @typedef {{\r\n *  currentRoom: string;\r\n *  rooms: {[id: string]: Room};\r\n *  users: {[id: string]: UserEntry}\r\n * }} State\r\n *\r\n * @param {State} state\r\n * @param {{type: string; payload: any}} action\r\n * @returns {State}\r\n */\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case \"clear\":\r\n      return { currentRoom: \"0\", rooms: {}, users: {} };\r\n    case \"set user\": {\r\n      return {\r\n        ...state,\r\n        users: { ...state.users, [action.payload.id]: action.payload },\r\n      };\r\n    }\r\n    case \"make user online\": {\r\n      return {\r\n        ...state,\r\n        users: {\r\n          ...state.users,\r\n          [action.payload]: { ...state.users[action.payload], online: true },\r\n        },\r\n      };\r\n    }\r\n    case \"append users\": {\r\n      return { ...state, users: { ...state.users, ...action.payload } };\r\n    }\r\n    case \"set messages\": {\r\n      return {\r\n        ...state,\r\n        rooms: {\r\n          ...state.rooms,\r\n          [action.payload.id]: {\r\n            ...state.rooms[action.payload.id],\r\n            messages: action.payload.messages,\r\n            offset: action.payload.messages.length,\r\n          },\r\n        },\r\n      };\r\n    }\r\n    case \"prepend messages\": {\r\n      const messages = [\r\n        ...action.payload.messages,\r\n        ...state.rooms[action.payload.id].messages,\r\n      ];\r\n      return {\r\n        ...state,\r\n        rooms: {\r\n          ...state.rooms,\r\n          [action.payload.id]: {\r\n            ...state.rooms[action.payload.id],\r\n            messages,\r\n            offset: messages.length,\r\n          },\r\n        },\r\n      };\r\n    }\r\n    case \"append message\":\r\n      return {\r\n        ...state,\r\n        rooms: {\r\n          ...state.rooms,\r\n          [action.payload.id]: {\r\n            ...state.rooms[action.payload.id],\r\n            lastMessage: action.payload.message,\r\n            messages: state.rooms[action.payload.id].messages\r\n              ? [\r\n                ...state.rooms[action.payload.id].messages,\r\n                action.payload.message,\r\n              ]\r\n              : undefined,\r\n          },\r\n        },\r\n      };\r\n    case 'set last message':\r\n      return { ...state, rooms: { ...state.rooms, [action.payload.id]: { ...state.rooms[action.payload.id], lastMessage: action.payload.lastMessage } } };\r\n    case \"set current room\":\r\n      return { ...state, currentRoom: action.payload };\r\n    case \"add room\":\r\n      return {\r\n        ...state,\r\n        rooms: { ...state.rooms, [action.payload.id]: action.payload },\r\n      };\r\n    case \"set rooms\": {\r\n      /** @type {Room[]} */\r\n      const newRooms = action.payload;\r\n      const rooms = { ...state.rooms };\r\n      newRooms.forEach((room) => {\r\n        rooms[room.id] = {\r\n          ...room,\r\n          messages: rooms[room.id] && rooms[room.id].messages,\r\n        };\r\n      });\r\n      return { ...state, rooms };\r\n    }\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\n/** @type {State} */\r\nconst initialState = {\r\n  currentRoom: \"main\",\r\n  rooms: {},\r\n  users: {},\r\n};\r\n\r\nconst useAppStateContext = () => {\r\n  return useReducer(reducer, initialState);\r\n};\r\n\r\n// @ts-ignore\r\nexport const AppContext = createContext();\r\n\r\n/**\r\n * @returns {[\r\n *  State,\r\n *  React.Dispatch<{\r\n *   type: string;\r\n *   payload: any;\r\n * }>\r\n * ]}\r\n */\r\nexport const useAppState = () => {\r\n  const [state, dispatch] = useContext(AppContext);\r\n  return [state, dispatch];\r\n};\r\n\r\nexport default useAppStateContext;","import axios from 'axios';\r\naxios.defaults.withCredentials = true;\r\n\r\nconst BASE_URL = '';\r\n\r\nexport const MESSAGES_TO_LOAD = 15;\r\n\r\nconst url = x => `${BASE_URL}${x}`;\r\n\r\n/** Checks if there's an existing session. */\r\nexport const getMe = () => {\r\n  return axios.get(url('/me'))\r\n    .then(x => x.data)\r\n    .catch(_ => null);\r\n};\r\n\r\n/** Handle user log in */\r\nexport const login = (username, password) => {\r\n  return axios.post(url('/login'), {\r\n    username,\r\n    password\r\n  }).then(x =>\r\n    x.data\r\n  )\r\n    .catch(e => { throw new Error(e.response && e.response.data && e.response.data.message); });\r\n};\r\n\r\nexport const logOut = () => {\r\n  return axios.post(url('/logout'));\r\n};\r\n\r\n/** \r\n * Function for checking which deployment urls exist.\r\n * \r\n * @returns {Promise<{\r\n *   heroku?: string;\r\n *   google_cloud?: string;\r\n *   vercel?: string;\r\n *   github?: string;\r\n * }>} \r\n */\r\nexport const getButtonLinks = () => {\r\n  return axios.get(url('/links'))\r\n    .then(x => x.data)\r\n    .catch(_ => null);\r\n};\r\n\r\n/** This was used to get a random login name (for demo purposes). */\r\nexport const getRandomName = () => {\r\n  return axios.get(url('/randomname')).then(x => x.data);\r\n};\r\n\r\n/**\r\n * Load messages\r\n * \r\n * @param {string} id room id\r\n * @param {number} offset \r\n * @param {number} size \r\n */\r\nexport const getMessages = (id,\r\n  offset = 0,\r\n  size = MESSAGES_TO_LOAD\r\n) => {\r\n  return axios.get(url(`/room/${id}/messages`), {\r\n    params: {\r\n      offset,\r\n      size\r\n    }\r\n  })\r\n    .then(x => x.data.reverse());\r\n};\r\n\r\n/**\r\n * @returns {Promise<{ name: string, id: string, messages: Array<import('./state').Message> }>}\r\n */\r\nexport const getPreloadedRoom = async () => {\r\n  return axios.get(url(`/room/0/preload`)).then(x => x.data);\r\n};\r\n\r\n/** \r\n * Fetch users by requested ids\r\n * @param {Array<number | string>} ids\r\n */\r\nexport const getUsers = (ids) => {\r\n  return axios.get(url(`/users`), { params: { ids } }).then(x => x.data);\r\n};\r\n\r\n/** Fetch users which are online */\r\nexport const getOnlineUsers = () => {\r\n  return axios.get(url(`/users/online`)).then(x => x.data);\r\n};\r\n\r\n/** This one is called on a private messages room created. */\r\nexport const addRoom = async (user1, user2) => {\r\n  return axios.post(url(`/room`), { user1, user2 }).then(x => x.data);\r\n};\r\n\r\n/** \r\n * @returns {Promise<Array<{ names: string[]; id: string }>>} \r\n */\r\nexport const getRooms = async (userId) => {\r\n  return axios.get(url(`/rooms/${userId}`)).then(x => x.data);\r\n};\r\n","// @ts-check\r\n\r\nimport { getUsers } from \"./api\";\r\n\r\n/**\r\n * @param {string[]} names\r\n * @param {string} username\r\n */\r\nexport const parseRoomName = (names, username) => {\r\n  for (let name of names) {\r\n    if (typeof name !== 'string') {\r\n      name = name[0];\r\n    }\r\n    if (name !== username) {\r\n      return name;\r\n    }\r\n  }\r\n  return names[0];\r\n};\r\n\r\n/** Get an avatar for a room or a user */\r\nexport const getAvatarByUserAndRoomId = (roomId = \"1\") => {\r\n  const TOTAL_IMAGES = 13;\r\n  const seed1 = 654;\r\n  const seed2 = 531;\r\n\r\n  const uidParsed = +roomId.split(\":\").pop();\r\n  let roomIdParsed = +roomId.split(\":\").reverse().pop();\r\n  if (roomIdParsed < 0) {\r\n    roomIdParsed += 3555;\r\n  }\r\n\r\n  const theId = (uidParsed * seed1 + roomIdParsed * seed2) % TOTAL_IMAGES;\r\n\r\n  return `${process.env.PUBLIC_URL}/avatars/${theId}.jpg`;\r\n};\r\n\r\nconst jdenticon = require(\"jdenticon\");\r\n\r\nconst avatars = {};\r\nexport const getAvatar = (username) => {\r\n  let av = avatars[username];\r\n  if (av === undefined) {\r\n    av =\r\n      \"data:image/svg+xml;base64,\" + window.btoa(jdenticon.toSvg(username, 50));\r\n    avatars[username] = av;\r\n  }\r\n  return av;\r\n};\r\n\r\nexport const populateUsersFromLoadedMessages = async (users, dispatch, messages) => {\r\n  const userIds = {};\r\n  messages.forEach((message) => {\r\n    userIds[message.from] = 1;\r\n  });\r\n\r\n  const ids = Object.keys(userIds).filter(\r\n    (id) => users[id] === undefined\r\n  );\r\n\r\n  if (ids.length !== 0) {\r\n    /** We need to fetch users first */\r\n    const newUsers = await getUsers(ids);\r\n    dispatch({\r\n      type: \"append users\",\r\n      payload: newUsers,\r\n    });\r\n  }\r\n\r\n};","const ChatIcon = () => (\n  <svg\n    width=\"32\"\n    height=\"32\"\n    viewBox=\"0 0 1651 1651\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <rect width=\"1651\" height=\"1651\" rx=\"14\" fill=\"white\" />\n    <path\n      d=\"M495.286 1098.96L497.967 1070.86L478.04 1050.88C408.572 981.233 368 891.771 368 795.344C368 585.371 565.306 402 826 402C1086.69 402 1284 585.371 1284 795.344C1284 1005.32 1086.69 1188.69 826 1188.69V1248.69L825.913 1188.69C779.837 1188.75 733.952 1182.77 689.432 1170.9L667.26 1164.98L646.8 1175.37C620.731 1188.61 562.74 1213.98 467.32 1235.35C480.554 1191.83 490.95 1144.39 495.286 1098.96Z\"\n      stroke=\"url(#paint0_linear)\"\n      strokeWidth=\"120\"\n    />\n    <defs>\n      <linearGradient\n        id=\"paint0_linear\"\n        x1=\"662.312\"\n        y1=\"397.956\"\n        x2=\"416.164\"\n        y2=\"1678.7\"\n        gradientUnits=\"userSpaceOnUse\"\n      >\n        <stop stopColor=\"#7514FB\" />\n        <stop offset=\"0.624243\" stopColor=\"#F26D41\" />\n        <stop offset=\"1\" stopColor=\"#F43B4B\" />\n      </linearGradient>\n    </defs>\n  </svg>\n);\n\nexport default ChatIcon;\n","// @ts-check\nimport React, { useMemo } from \"react\";\nimport { getAvatarByUserAndRoomId } from \"../../../../../utils\";\nimport ChatIcon from \"./ChatIcon\";\n\nconst AvatarImage = ({ name, id }) => {\n  const url = useMemo(() => {\n    const av = getAvatarByUserAndRoomId(\"\" + id);\n    if (name === \"Mary\") {\n      return `${process.env.PUBLIC_URL}/avatars/0.jpg`;\n    } else if (name === \"Pablo\") {\n      return `${process.env.PUBLIC_URL}/avatars/2.jpg`;\n    } else if (name === \"Joe\") {\n      return `${process.env.PUBLIC_URL}/avatars/9.jpg`;\n    } else if (name === \"Alex\") {\n      return `${process.env.PUBLIC_URL}/avatars/8.jpg`;\n    }\n    return av;\n  }, [id, name]);\n\n  return (\n    <>\n      {name !== \"General\" ? (\n        <img\n          src={url}\n          alt={name}\n          style={{ width: 32, height: 32, objectFit: \"cover\" }}\n          className=\"rounded-circle avatar-xs\"\n        />\n      ) : (\n        <div className=\"overflow-hidden rounded-circle\">\n          <ChatIcon />\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default AvatarImage;\n","const OnlineIndicator = ({ online, hide = false, width = 8, height = 8 }) => {\n  return (\n    <div\n      className={\n        online ? \"rounded-circle bg-success\" : \"rounded-circle bg-gray\"\n      }\n      style={{ width, height, opacity: hide ? 0 : 1 }}\n    ></div>\n  );\n};\n\nexport default OnlineIndicator;\n","// @ts-check\nimport \"./style.css\";\nimport React, { useMemo } from \"react\";\nimport { useAppState } from \"../../../../../../state\";\nimport moment from \"moment\";\nimport { useEffect } from \"react\";\nimport { getMessages } from \"../../../../../../api\";\nimport AvatarImage from \"../AvatarImage\";\nimport OnlineIndicator from \"../../../OnlineIndicator\";\n\n/**\n * @param {{ active: boolean; room: import('../../../../../../state').Room; onClick: () => void; }} props\n */\nconst ChatListItem = ({ room, active = false, onClick }) => {\n  const { online, name, lastMessage, userId } = useChatListItemHandlers(room);\n  return (\n    <div\n      onClick={onClick}\n      className={`chat-list-item d-flex align-items-start rounded ${\n        active ? \"bg-white\" : \"\"\n      }`}\n    >\n      <div className=\"align-self-center mr-3\">\n        <OnlineIndicator online={online} hide={room.id === \"0\"} />\n      </div>\n      <div className=\"align-self-center mr-3\">\n        <AvatarImage name={name} id={userId} />\n      </div>\n      <div className=\"media-body overflow-hidden\">\n        <h5 className=\"text-truncate font-size-14 mb-1\">{name}</h5>\n        {lastMessage && (\n          <p className=\"text-truncate mb-0\"> {lastMessage.message} </p>\n        )}\n      </div>\n      {lastMessage && (\n        <div className=\"font-size-11\">\n          {moment.unix(lastMessage.date).format(\"LT\")}\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst useChatListItemHandlers = (\n  /** @type {import(\"../../../../../../state\").Room} */ room\n) => {\n  const { id, name } = room;\n  const [state] = useAppState();\n\n  /** Here we want to associate the room with a user by its name (since it's unique). */\n  const [isUser, online, userId] = useMemo(() => {\n    try {\n      let pseudoUserId = Math.abs(parseInt(id.split(\":\").reverse().pop()));\n      const isUser = pseudoUserId > 0;\n      const usersFiltered = Object.entries(state.users)\n        .filter(([, user]) => user.username === name)\n        .map(([, user]) => user);\n      let online = false;\n      if (usersFiltered.length > 0) {\n        online = usersFiltered[0].online;\n        pseudoUserId = +usersFiltered[0].id;\n      }\n      return [isUser, online, pseudoUserId];\n    } catch (_) {\n      return [false, false, \"0\"];\n    }\n  }, [id, name, state.users]);\n\n  const lastMessage = useLastMessage(room);\n\n  return {\n    isUser,\n    online,\n    userId,\n    name: room.name,\n    lastMessage,\n  };\n};\n\nconst useLastMessage = (\n  /** @type {import(\"../../../../../../state\").Room} */ room\n) => {\n  const [, dispatch] = useAppState();\n  const { lastMessage } = room;\n  useEffect(() => {\n    if (lastMessage === undefined) {\n      /** need to fetch it */\n      if (room.messages === undefined) {\n        getMessages(room.id, 0, 1).then((messages) => {\n          let message = null;\n          if (messages.length !== 0) {\n            message = messages.pop();\n          }\n          dispatch({\n            type: \"set last message\",\n            payload: { id: room.id, lastMessage: message },\n          });\n        });\n      } else if (room.messages.length === 0) {\n        dispatch({\n          type: \"set last message\",\n          payload: { id: room.id, lastMessage: null },\n        });\n      } else {\n        dispatch({\n          type: \"set last message\",\n          payload: {\n            id: room.id,\n            lastMessage: room.messages[room.messages.length - 1],\n          },\n        });\n      }\n    }\n  }, [lastMessage, dispatch, room]);\n\n  return lastMessage;\n};\n\nexport default ChatListItem;\n","// @ts-check\n\nimport React from \"react\";\nimport { Power } from \"react-bootstrap-icons\";\nimport OnlineIndicator from \"../../OnlineIndicator\";\nimport AvatarImage from \"./AvatarImage\";\n\nconst Footer = ({ user, onLogOut }) => (\n  <div\n    className=\"row no-gutters align-items-center pl-4 pr-2 pb-3\"\n    style={{ height: \"inherit\", flex: 0, minHeight: 50 }}\n  >\n    {true ? (\n      <>\n        <UserInfo user={user} col={8} />\n        <LogoutButton onLogOut={onLogOut} col={4} />\n      </>\n    ) : (\n      <>\n        <LogoutButton noinfo onLogOut={onLogOut} col={8} />\n        <UserInfo noinfo user={user} col={4} />\n      </>\n    )}\n  </div>\n);\n\nconst LogoutButton = ({ onLogOut, col = 5, noinfo = false }) => (\n  <div\n    onClick={onLogOut}\n    style={{ cursor: \"pointer\" }}\n    className={`col-${col} text-danger ${!noinfo ? \"text-right\" : \"\"}`}\n  >\n    <Power /> Log out\n  </div>\n);\n\nconst UserInfo = ({ user, col = 7, noinfo = false }) => (\n  <div\n    className={`col-${col} d-flex align-items-center ${\n      noinfo ? \"justify-content-end\" : \"\"\n    }`}\n  >\n    <div className={`align-self-center ${noinfo ? \"\" : \"mr-3\"}`}>\n      <AvatarImage name={user.username} id={user.id} />\n    </div>\n    {!noinfo && (\n      <div className=\"media-body\">\n        <h5 className=\"font-size-14 mt-0 mb-1\">{user.username}</h5>\n        <div className=\"d-flex align-items-center\">\n          <OnlineIndicator online={true} />\n          <p className=\"ml-2 text-muted mb-0\">Active</p>\n        </div>\n      </div>\n    )}\n  </div>\n);\n\nexport default Footer;\n","// @ts-check\nimport React, { useMemo } from \"react\";\nimport ChatListItem from \"./components/ChatListItem\";\nimport Footer from \"./components/Footer\";\n\nconst ChatList = ({ rooms, dispatch, user, currentRoom, onLogOut }) => {\n  const processedRooms = useMemo(() => {\n    const roomsList = Object.values(rooms);\n    const main = roomsList.filter((x) => x.id === \"0\");\n    let other = roomsList.filter((x) => x.id !== \"0\");\n    other = other.sort(\n      (a, b) => +a.id.split(\":\").pop() - +b.id.split(\":\").pop()\n    );\n    return [...(main ? main : []), ...other];\n  }, [rooms]);\n  return (\n    <>\n      <div className=\"chat-list-container flex-column d-flex pr-4\">\n        <div className=\"py-2\">\n          <p className=\"h5 mb-0 py-1 chats-title\">Chats</p>\n        </div>\n        <div className=\"messages-box flex flex-1\">\n          <div className=\"list-group rounded-0\">\n            {processedRooms.map((room) => (\n              <ChatListItem\n                key={room.id}\n                onClick={() =>\n                  dispatch({ type: \"set current room\", payload: room.id })\n                }\n                active={currentRoom === room.id}\n                room={room}\n              />\n            ))}\n          </div>\n        </div>\n        <Footer user={user} onLogOut={onLogOut} />\n      </div>\n    </>\n  );\n};\n\nexport default ChatList;\n","// @ts-check\nconst InfoMessage = ({ message }) => {\n  return (\n    <p\n      className=\"mb-2 fs-6 fw-light fst-italic text-black-50 text-center\"\n      style={{ opacity: 0.8, fontSize: 14 }}\n    >\n      {message}\n    </p>\n  );\n};\n\nexport default InfoMessage;\n","// @ts-check\nimport React from \"react\";\n\nconst MessagesLoading = () => {\n  return (\n    <div className=\"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center\">\n      <div className=\"spinner-border\" role=\"status\">\n        <span className=\"visually-hidden\" />\n      </div>\n    </div>\n  );\n};\n\nexport default MessagesLoading;\n","// @ts-check\nimport React from \"react\";\nimport { CardText } from \"react-bootstrap-icons\";\n\nconst NoMessages = () => {\n  return (\n    <div className=\"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center\">\n      <CardText size={96} />\n      <p>No messages</p>\n    </div>\n  );\n};\n\nexport default NoMessages;\n","const ClockIcon = () => (\n  <svg\n    width={12}\n    height={12}\n    className=\"prefix__MuiSvgIcon-root prefix__jss80 prefix__MuiSvgIcon-fontSizeLarge\"\n    viewBox=\"0 0 24 24\"\n    aria-hidden=\"true\"\n  >\n    <path d=\"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z\" />\n    <path d=\"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z\" />\n  </svg>\n);\n\nexport default ClockIcon;\n","// @ts-check\nimport moment from \"moment\";\nimport React from \"react\";\nimport ClockIcon from \"./ClockIcon\";\n\nconst ReceiverMessage = ({\n  username = \"user\",\n  message = \"Lorem ipsum dolor...\",\n  date,\n}) => (\n  <div className=\"d-flex\">\n    <div style={{ flex: 1 }} />\n    <div style={{ width: \"50%\" }} className=\"text-right mb-4\">\n      <div\n        className=\"conversation-list d-inline-block bg-light px-3 py-2\"\n        style={{ borderRadius: 12 }}\n      >\n        <div className=\"ctext-wrap\">\n          <div\n            className=\"conversation-name text-left text-primary mb-1\"\n            style={{\n              fontWeight: 600,\n            }}\n          >\n            {username}\n          </div>\n          <p className=\"text-left\">{message}</p>\n          <p className=\"chat-time mb-0\">\n            <ClockIcon /> {moment.unix(date).format(\"LT\")}{\" \"}\n          </p>\n        </div>\n      </div>\n    </div>\n  </div>\n);\nexport default ReceiverMessage;\n","// @ts-check\nimport moment from \"moment\";\nimport React from \"react\";\nimport ClockIcon from \"./ClockIcon\";\nimport OnlineIndicator from \"../../OnlineIndicator\";\n\nconst SenderMessage = ({\n  user,\n  message = \"Lorem ipsum dolor...\",\n  date,\n  onUserClicked,\n}) => (\n  <div className=\"d-flex\">\n    <div style={{ width: \"50%\" }} className=\"text-left mb-4\">\n      <div\n        className=\"conversation-list d-inline-block px-3 py-2\"\n        style={{ borderRadius: 12, backgroundColor: \"rgba(85, 110, 230, 0.1)\" }}\n      >\n        <div className=\"ctext-wrap\">\n          {user && (\n            <div className=\"conversation-name text-primary d-flex align-items-center mb-1\">\n              <div\n                className=\"mr-2\"\n                style={{\n                  fontWeight: 600,\n                  cursor: \"pointer\",\n                }}\n                onClick={onUserClicked}\n              >\n                {user.username}\n              </div>\n              <OnlineIndicator width={7} height={7} online={user.online} />\n            </div>\n          )}\n          <p className=\"text-left\">{message}</p>\n          <p className=\"chat-time mb-0\">\n            <ClockIcon /> {moment.unix(date).format(\"LT\")}{\" \"}\n          </p>\n        </div>\n      </div>\n    </div>\n    <div style={{ flex: 1 }} />\n  </div>\n);\n\nexport default SenderMessage;\n","// @ts-check\nimport React from \"react\";\nimport { MESSAGES_TO_LOAD } from \"../../../../api\";\nimport InfoMessage from \"./components/InfoMessage\";\nimport MessagesLoading from \"./components/MessagesLoading\";\nimport NoMessages from \"./components/NoMessages\";\nimport ReceiverMessage from \"./components/ReceiverMessage\";\nimport SenderMessage from \"./components/SenderMessage\";\n\nconst MessageList = ({\n  messageListElement,\n  messages,\n  room,\n  onLoadMoreMessages,\n  user,\n  onUserClicked,\n  users,\n}) => (\n  <div\n    ref={messageListElement}\n    className=\"chat-box-wrapper position-relative d-flex\"\n  >\n    {messages === undefined ? (\n      <MessagesLoading />\n    ) : messages.length === 0 ? (\n      <NoMessages />\n    ) : (\n      <></>\n    )}\n    <div className=\"px-4 pt-5 chat-box position-absolute\">\n      {messages && messages.length !== 0 && (\n        <>\n          {room.offset && room.offset >= MESSAGES_TO_LOAD ? (\n            <div className=\"d-flex flex-row align-items-center mb-4\">\n              <div\n                style={{ height: 1, backgroundColor: \"#eee\", flex: 1 }}\n              ></div>\n              <div className=\"mx-3\">\n                <button\n                  aria-haspopup=\"true\"\n                  aria-expanded=\"true\"\n                  type=\"button\"\n                  onClick={onLoadMoreMessages}\n                  className=\"btn rounded-button btn-secondary nav-btn\"\n                  id=\"__BVID__168__BV_toggle_\"\n                >\n                  Load more\n                </button>\n              </div>\n              <div\n                style={{ height: 1, backgroundColor: \"#eee\", flex: 1 }}\n              ></div>\n            </div>\n          ) : (\n            <></>\n          )}\n          {messages.map((message, x) => {\n            const key = message.message + message.date + message.from + x;\n            if (message.from === \"info\") {\n              return <InfoMessage key={key} message={message.message} />;\n            }\n            if (+message.from !== +user.id) {\n              return (\n                <SenderMessage\n                  onUserClicked={() => onUserClicked(message.from)}\n                  key={key}\n                  message={message.message}\n                  date={message.date}\n                  user={users[message.from]}\n                />\n              );\n            }\n            return (\n              <ReceiverMessage\n                username={\n                  users[message.from] ? users[message.from].username : \"\"\n                }\n                key={key}\n                message={message.message}\n                date={message.date}\n              />\n            );\n          })}\n        </>\n      )}\n    </div>\n  </div>\n);\nexport default MessageList;\n","// @ts-check\nconst TypingArea = ({ message, setMessage, onSubmit }) => (\n  <div className=\"p-3 chat-input-section\">\n    <form className=\"row\" onSubmit={onSubmit}>\n      <div className=\"col\">\n        <div className=\"position-relative\">\n          <input\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            type=\"text\"\n            placeholder=\"Enter Message...\"\n            className=\"form-control chat-input\"\n          />\n          {/**/}\n        </div>\n      </div>\n      <div className=\"col-auto\">\n        <button\n          type=\"submit\"\n          className=\"btn btn-primary btn-rounded chat-send w-md\"\n        >\n          <span className=\"d-none d-sm-inline-block mr-2\">Send</span>\n          <svg width={13} height={13} viewBox=\"0 0 24 24\" tabIndex={-1}>\n            <path d=\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\" fill=\"white\" />\n          </svg>\n        </button>\n      </div>\n    </form>\n  </div>\n);\n\nexport default TypingArea;\n","// @ts-check\nimport { useCallback } from \"react\";\nimport { useEffect, useState, useRef } from \"react\";\nimport { addRoom, getMessages, getUsers } from \"../../api\";\nimport { useAppState } from \"../../state\";\nimport { parseRoomName, populateUsersFromLoadedMessages } from \"../../utils\";\n\n/** Lifecycle hooks with callbacks for the Chat component */\nconst useChatHandlers = (/** @type {import(\"../../state\").UserEntry} */ user) => {\n  const [state, dispatch] = useAppState();\n  const messageListElement = useRef(null);\n\n  /** @type {import(\"../../state\").Room} */\n  const room = state.rooms[state.currentRoom];\n  const roomId = room?.id;\n  const messages = room?.messages;\n\n  const [message, setMessage] = useState(\"\");\n\n  const scrollToTop = useCallback(() => {\n    setTimeout(() => {\n      if (messageListElement.current) {\n        messageListElement.current.scrollTop = 0;\n      }\n    }, 0);\n  }, []);\n\n  const scrollToBottom = useCallback(() => {\n    if (messageListElement.current) {\n      messageListElement.current.scrollTo({\n        top: messageListElement.current.scrollHeight,\n      });\n    }\n  }, []);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, scrollToBottom]);\n\n  const onFetchMessages = useCallback(\n    (offset = 0, prepend = false) => {\n      getMessages(roomId, offset).then(async (messages) => {\n        /** We've got messages but it's possible we might not have the cached user entires which correspond to those messages */\n        await populateUsersFromLoadedMessages(state.users, dispatch, messages);\n\n        dispatch({\n          type: prepend ? \"prepend messages\" : \"set messages\",\n          payload: { id: roomId, messages: messages },\n        });\n        if (prepend) {\n          setTimeout(() => {\n            scrollToTop();\n          }, 10);\n        } else {\n          scrollToBottom();\n        }\n      });\n    },\n    [dispatch, roomId, scrollToBottom, scrollToTop, state.users]\n  );\n\n  useEffect(() => {\n    if (roomId === undefined) {\n      return;\n    }\n    if (messages === undefined) {\n      /** Fetch logic goes here */\n      onFetchMessages();\n    }\n  }, [\n    messages,\n    dispatch,\n    roomId,\n    state.users,\n    state,\n    scrollToBottom,\n    onFetchMessages,\n  ]);\n\n  useEffect(() => {\n    if (messageListElement.current) {\n      scrollToBottom();\n    }\n  }, [scrollToBottom, roomId]);\n\n  const onUserClicked = async (userId) => {\n    /** Check if room exists. */\n    const targetUser = state.users[userId];\n    let roomId = targetUser.room;\n    if (roomId === undefined) {\n      // @ts-ignore\n      const room = await addRoom(userId, user.id);\n      roomId = room.id;\n      /** We need to set this room id to user. */\n      dispatch({ type: \"set user\", payload: { ...targetUser, room: roomId } });\n      /** Then a new room should be added to the store. */\n      dispatch({\n        type: \"add room\",\n        // @ts-ignore\n        payload: { id: roomId, name: parseRoomName(room.names, user.username) },\n      });\n    }\n    /** Then a room should be changed */\n    dispatch({ type: \"set current room\", payload: roomId });\n  };\n\n  const onLoadMoreMessages = useCallback(() => {\n    onFetchMessages(room.offset, true);\n  }, [onFetchMessages, room]);\n\n  return {\n    onLoadMoreMessages,\n    onUserClicked,\n    message,\n    setMessage,\n    dispatch,\n    room,\n    rooms: state.rooms,\n    currentRoom: state.currentRoom,\n    messageListElement,\n    roomId,\n    users: state.users,\n    messages,\n  };\n};\nexport default useChatHandlers;","// @ts-check\r\nimport React from \"react\";\r\nimport ChatList from \"./components/ChatList\";\r\nimport MessageList from \"./components/MessageList\";\r\nimport TypingArea from \"./components/TypingArea\";\r\nimport useChatHandlers from \"./use-chat-handlers\";\r\n\r\n/**\r\n * @param {{\r\n *  onLogOut: () => void,\r\n *  onMessageSend: (message: string, roomId: string) => void,\r\n *  user: import(\"../../state\").UserEntry\r\n * }} props\r\n */\r\nexport default function Chat({ onLogOut, user, onMessageSend }) {\r\n  const {\r\n    onLoadMoreMessages,\r\n    onUserClicked,\r\n    message,\r\n    setMessage,\r\n    rooms,\r\n    room,\r\n    currentRoom,\r\n    dispatch,\r\n    messageListElement,\r\n    roomId,\r\n    messages,\r\n    users,\r\n  } = useChatHandlers(user);\r\n\r\n  return (\r\n    <div className=\"container py-5 px-4\">\r\n      <div className=\"chat-body row overflow-hidden shadow bg-light rounded\">\r\n        <div className=\"col-4 px-0\">\r\n          <ChatList\r\n            user={user}\r\n            onLogOut={onLogOut}\r\n            rooms={rooms}\r\n            currentRoom={currentRoom}\r\n            dispatch={dispatch}\r\n          />\r\n        </div>\r\n        {/* Chat Box*/}\r\n        <div className=\"col-8 px-0 flex-column bg-white rounded-lg\">\r\n          <div className=\"px-4 py-4\" style={{ borderBottom: \"1px solid #eee\" }}>\r\n            <h2 className=\"font-size-15 mb-0\">{room ? room.name : \"Room\"}</h2>\r\n          </div>\r\n          <MessageList\r\n            messageListElement={messageListElement}\r\n            messages={messages}\r\n            room={room}\r\n            onLoadMoreMessages={onLoadMoreMessages}\r\n            user={user}\r\n            onUserClicked={onUserClicked}\r\n            users={users}\r\n          />\r\n\r\n          {/* Typing area */}\r\n          <TypingArea\r\n            message={message}\r\n            setMessage={setMessage}\r\n            onSubmit={(e) => {\r\n              e.preventDefault();\r\n              onMessageSend(message.trim(), roomId);\r\n              setMessage(\"\");\r\n\r\n              messageListElement.current.scrollTop =\r\n                messageListElement.current.scrollHeight;\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// @ts-check\r\nimport React from \"react\";\r\n\r\nexport function LoadingScreen() {\r\n  return (\r\n    <div className=\"centered-box\">\r\n      <div className=\"spinner-border\" role=\"status\">\r\n        <span className=\"visually-hidden\" />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// @ts-check\nimport React, { useEffect, useState } from \"react\";\nimport { getButtonLinks } from \"../api\";\n\nconst Navbar = () => {\n  /**\n   * @type {[{\n   *  heroku?: string;\n   *  google_cloud?: string;\n   *  vercel?: string;\n   *  github?: string;\n   *  }, React.Dispatch<any>]}\n   */\n  const [links, setLinks] = useState(null);\n  useEffect(() => {\n    getButtonLinks().then(setLinks);\n  }, []);\n  return (\n    <nav className=\"navbar navbar-expand-lg navbar-light bg-white\">\n      <span className=\"navbar-brand\">Redis chat demo</span>\n      {links !== null ? (\n        <span className=\"navbar-text\">\n          {links.github && <GithubIcon link={links.github} />}\n        </span>\n      ) : (\n        <></>\n      )}\n    </nav>\n  );\n};\n\nconst GithubIcon = ({ link }) => (\n  <a\n    href={link}\n    // eslint-disable-next-line\n    target=\"_blank\"\n    title=\"Github\"\n  >\n    <svg\n      width={24}\n      height={24}\n      viewBox=\"0 0 64 64\"\n      aria-labelledby=\"title\"\n      aria-describedby=\"desc\"\n      role=\"img\"\n    >\n      <path\n        data-name=\"layer2\"\n        d=\"M32 0a32.021 32.021 0 0 0-10.1 62.4c1.6.3 2.2-.7 2.2-1.5v-6c-8.9 1.9-10.8-3.8-10.8-3.8-1.5-3.7-3.6-4.7-3.6-4.7-2.9-2 .2-1.9.2-1.9 3.2.2 4.9 3.3 4.9 3.3 2.9 4.9 7.5 3.5 9.3 2.7a6.93 6.93 0 0 1 2-4.3c-7.1-.8-14.6-3.6-14.6-15.8a12.27 12.27 0 0 1 3.3-8.6 11.965 11.965 0 0 1 .3-8.5s2.7-.9 8.8 3.3a30.873 30.873 0 0 1 8-1.1 30.292 30.292 0 0 1 8 1.1c6.1-4.1 8.8-3.3 8.8-3.3a11.965 11.965 0 0 1 .3 8.5 12.1 12.1 0 0 1 3.3 8.6c0 12.3-7.5 15-14.6 15.8a7.746 7.746 0 0 1 2.2 5.9v8.8c0 .9.6 1.8 2.2 1.5A32.021 32.021 0 0 0 32 0z\"\n        fill=\"#595F70\"\n      ></path>\n      <path\n        data-name=\"layer1\"\n        d=\"M12.1 45.9c-.1.2-.3.2-.5.1s-.4-.3-.3-.5.3-.2.6-.1c.2.2.3.4.2.5zm1.3 1.5a.589.589 0 0 1-.8-.8.631.631 0 0 1 .7.1.494.494 0 0 1 .1.7zm1.3 1.8a.585.585 0 0 1-.7-.3.6.6 0 0 1 0-.8.585.585 0 0 1 .7.3c.2.3.2.7 0 .8zm1.7 1.8c-.2.2-.5.1-.8-.1-.3-.3-.4-.6-.2-.8a.619.619 0 0 1 .8.1.554.554 0 0 1 .2.8zm2.4 1c-.1.3-.4.4-.8.3s-.6-.4-.5-.7.4-.4.8-.3c.3.2.6.5.5.7zm2.6.2c0 .3-.3.5-.7.5s-.7-.2-.7-.5.3-.5.7-.5c.4.1.7.3.7.5zm2.4-.4q0 .45-.6.6a.691.691 0 0 1-.8-.3q0-.45.6-.6c.5-.1.8.1.8.3z\"\n        fill=\"#595F70\"\n      ></path>\n    </svg>\n  </a>\n);\n\nexport default Navbar;\n","// @ts-check\nimport { useEffect, useRef, useState } from \"react\";\nimport { getMe, login, logOut } from \"./api\";\nimport io from \"socket.io-client\";\nimport { parseRoomName } from \"./utils\";\n\n/**\n * @param {import('./state').UserEntry} newUser\n */\nconst updateUser = (newUser, dispatch, infoMessage) => {\n  dispatch({ type: \"set user\", payload: newUser });\n  if (infoMessage !== undefined) {\n    dispatch({\n      type: \"append message\",\n      payload: {\n        id: \"0\",\n        message: {\n          /** Date isn't shown in the info message, so we only need a unique value */\n          date: Math.random() * 10000,\n          from: \"info\",\n          message: infoMessage,\n        },\n      },\n    });\n  }\n};\n\n/** @returns {[SocketIOClient.Socket, boolean]} */\nconst useSocket = (user, dispatch) => {\n  const [connected, setConnected] = useState(false);\n  /** @type {React.MutableRefObject<SocketIOClient.Socket>} */\n  const socketRef = useRef(null);\n  const socket = socketRef.current;\n\n  /** First of all it's necessary to handle the socket io connection */\n  useEffect(() => {\n    if (user === null) {\n      if (socket !== null) {\n        socket.disconnect();\n      }\n      setConnected(false);\n    } else {\n      if (socket !== null) {\n        socket.connect();\n      } else {\n        socketRef.current = io();\n      }\n      setConnected(true);\n    }\n  }, [user, socket]);\n\n  /**\n   * Once we are sure the socket io object is initialized\n   * Add event listeners.\n   */\n  useEffect(() => {\n    if (connected && user) {\n      socket.on(\"user.connected\", (newUser) => {\n        updateUser(newUser, dispatch, `${newUser.username} connected`);\n      });\n      socket.on(\"user.disconnected\", (newUser) =>\n        updateUser(newUser, dispatch, `${newUser.username} left`)\n      );\n      socket.on(\"show.room\", (room) => {\n        console.log({ user });\n        dispatch({\n          type: \"add room\",\n          payload: {\n            id: room.id,\n            name: parseRoomName(room.names, user.username),\n          },\n        });\n      });\n      socket.on(\"message\", (message) => {\n        /** Set user online */\n        dispatch({\n          type: \"make user online\",\n          payload: message.from,\n        });\n        dispatch({\n          type: \"append message\",\n          payload: { id: message.roomId, message },\n        });\n      });\n    } else {\n      /** If there was a log out, we need to clear existing listeners on an active socket connection */\n      if (socket) {\n        socket.off(\"user.connected\");\n        socket.off(\"user.disconnected\");\n        socket.off(\"user.room\");\n        socket.off(\"message\");\n      }\n    }\n  }, [connected, user, dispatch, socket]);\n\n  return [socket, connected];\n};\n\n/** User management hook. */\nconst useUser = (onUserLoaded = (user) => { }, dispatch) => {\n  const [loading, setLoading] = useState(true);\n  /** @type {[import('./state.js').UserEntry | null, React.Dispatch<import('./state.js').UserEntry>]} */\n  const [user, setUser] = useState(null);\n  /** Callback used in log in form. */\n  const onLogIn = (\n    username = \"\",\n    password = \"\",\n    onError = (val = null) => { },\n    onLoading = (loading = false) => { }\n  ) => {\n    onError(null);\n    onLoading(true);\n    login(username, password)\n      .then((x) => {\n        setUser(x);\n      })\n      .catch((e) => onError(e.message))\n      .finally(() => onLoading(false));\n  };\n\n  /** Log out form */\n  const onLogOut = async () => {\n    logOut().then(() => {\n      setUser(null);\n      /** This will clear the store, to completely re-initialize an app on the next login. */\n      dispatch({ type: \"clear\" });\n      setLoading(true);\n    });\n  };\n\n  /** Runs once when the component is mounted to check if there's user stored in cookies */\n  useEffect(() => {\n    if (!loading) {\n      return;\n    }\n    getMe().then((user) => {\n      setUser(user);\n      setLoading(false);\n      onUserLoaded(user);\n    });\n  }, [onUserLoaded, loading]);\n\n  return { user, onLogIn, onLogOut, loading };\n};\n\nexport {\n  updateUser,\n  useSocket,\n  useUser\n};","// @ts-check\r\nimport React, { useEffect, useCallback } from \"react\";\r\nimport Login from \"./components/Login\";\r\nimport Chat from \"./components/Chat\";\r\nimport { getOnlineUsers, getRooms } from \"./api\";\r\nimport useAppStateContext, { AppContext } from \"./state\";\r\nimport moment from \"moment\";\r\nimport { parseRoomName } from \"./utils\";\r\nimport { LoadingScreen } from \"./components/LoadingScreen\";\r\nimport Navbar from \"./components/Navbar\";\r\nimport { useSocket, useUser } from \"./hooks\";\r\n\r\nconst App = () => {\r\n  const {\r\n    loading,\r\n    user,\r\n    state,\r\n    dispatch,\r\n    onLogIn,\r\n    onMessageSend,\r\n    onLogOut,\r\n  } = useAppHandlers();\r\n\r\n  if (loading) {\r\n    return <LoadingScreen />;\r\n  }\r\n\r\n  const showLogin = !user;\r\n\r\n  return (\r\n    <AppContext.Provider value={[state, dispatch]}>\r\n      <div\r\n        className={`full-height ${showLogin ? \"bg-light\" : \"\"}`}\r\n        style={{\r\n          backgroundColor: !showLogin ? \"#495057\" : undefined,\r\n        }}\r\n      >\r\n        <Navbar />\r\n        {showLogin ? (\r\n          <Login onLogIn={onLogIn} />\r\n        ) : (\r\n          <Chat user={user} onMessageSend={onMessageSend} onLogOut={onLogOut} />\r\n        )}\r\n      </div>\r\n    </AppContext.Provider>\r\n  );\r\n};\r\n\r\nconst useAppHandlers = () => {\r\n  const [state, dispatch] = useAppStateContext();\r\n  const onUserLoaded = useCallback(\r\n    (user) => {\r\n      if (user !== null) {\r\n        if (!state.users[user.id]) {\r\n          dispatch({ type: \"set user\", payload: { ...user, online: true } });\r\n        }\r\n      }\r\n    },\r\n    [dispatch, state.users]\r\n  );\r\n\r\n  const { user, onLogIn, onLogOut, loading } = useUser(onUserLoaded, dispatch);\r\n  const [socket, connected] = useSocket(user, dispatch);\r\n\r\n  /** Socket joins specific rooms once they are added */\r\n  useEffect(() => {\r\n    if (user === null) {\r\n      /** We are logged out */\r\n      /** But it's necessary to pre-populate the main room, so the user won't wait for messages once he's logged in */\r\n      return;\r\n    }\r\n    if (connected) {\r\n      /**\r\n       * The socket needs to be joined to the newly added rooms\r\n       * on an active connection.\r\n       */\r\n      const newRooms = [];\r\n      Object.keys(state.rooms).forEach((roomId) => {\r\n        const room = state.rooms[roomId];\r\n        if (room.connected) {\r\n          return;\r\n        }\r\n        newRooms.push({ ...room, connected: true });\r\n        socket.emit(\"room.join\", room.id);\r\n      });\r\n      if (newRooms.length !== 0) {\r\n        dispatch({ type: \"set rooms\", payload: newRooms });\r\n      }\r\n    } else {\r\n      /**\r\n       * It's necessary to set disconnected flags on rooms\r\n       * once the client is not connected\r\n       */\r\n      const newRooms = [];\r\n      Object.keys(state.rooms).forEach((roomId) => {\r\n        const room = state.rooms[roomId];\r\n        if (!room.connected) {\r\n          return;\r\n        }\r\n        newRooms.push({ ...room, connected: false });\r\n      });\r\n      /** Only update the state if it's only necessary */\r\n      if (newRooms.length !== 0) {\r\n        dispatch({ type: \"set rooms\", payload: newRooms });\r\n      }\r\n    }\r\n  }, [user, connected, dispatch, socket, state.rooms, state.users]);\r\n\r\n  /** Populate default rooms when user is not null */\r\n  useEffect(() => {\r\n    if (Object.values(state.rooms).length === 0 && user !== null) {\r\n      /** First of all fetch online users. */\r\n      getOnlineUsers().then((users) => {\r\n        dispatch({\r\n          type: \"append users\",\r\n          payload: users,\r\n        });\r\n      });\r\n      /** Then get rooms. */\r\n      getRooms(user.id).then((rooms) => {\r\n        const payload = [];\r\n        rooms.forEach(({ id, names }) => {\r\n          payload.push({ id, name: parseRoomName(names, user.username) });\r\n        });\r\n        /** Here we also can populate the state with default chat rooms */\r\n        dispatch({\r\n          type: \"set rooms\",\r\n          payload,\r\n        });\r\n        dispatch({ type: \"set current room\", payload: \"0\" });\r\n      });\r\n    }\r\n  }, [dispatch, state.rooms, user]);\r\n\r\n  const onMessageSend = useCallback(\r\n    (message, roomId) => {\r\n      if (typeof message !== \"string\" || message.trim().length === 0) {\r\n        return;\r\n      }\r\n      if (!socket) {\r\n        /** Normally there shouldn't be such case. */\r\n        console.error(\"Couldn't send message\");\r\n      }\r\n      socket.emit(\"message\", {\r\n        roomId: roomId,\r\n        message,\r\n        from: user.id,\r\n        date: moment(new Date()).unix(),\r\n      });\r\n    },\r\n    [user, socket]\r\n  );\r\n\r\n  return {\r\n    loading,\r\n    user,\r\n    state,\r\n    dispatch,\r\n    onLogIn,\r\n    onMessageSend,\r\n    onLogOut,\r\n  };\r\n};\r\n\r\nexport default App;\r\n","import \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport \"./styles/style-overrides.css\";\r\nimport \"./styles/style.css\";\r\nimport \"./styles/font-face.css\";\r\n\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nimport App from \"./App\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}